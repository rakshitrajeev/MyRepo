import json
import nltk
import spacy
import en_core_web_sm
from nltk.stem import WordNetLemmatizer 
from spacy import displacy
from collections import Counter
from operator import or_
nlp = en_core_web_sm.load()

lemmatizer = WordNetLemmatizer()

from flask import  Flask  #pip3 install Flask
from flask.json import jsonify
import json
from flask import request
app = Flask(__name__)

def calculateTwitterUsers(eventName, tweets):
    listOfTwittNames = []
    count = 0;
    for eachTwitt in tweets['tweets']:
        twittText = eachTwitt['full_text']

        listOfTwittNames.append(twittText)
        doc = nlp(twittText)
        for X in doc.ents:
            print(X.text, X.label_)
            if lemmatizer.lemmatize(X.text) == 'Eagle' or 'Eagle' in X.text or 'Eagle' in lemmatizer.lemmatize(X.text):
                count = count+1
                continue
    
    return jsonify(count)

@app.route('/count/<ticketMasterEvent>',methods=['POST'])
def count(ticketMasterEvent):

    print(ticketMasterEvent)
    twitter_dict = request.get_json()
    print(twitter_dict)
    
    
    
    
    return calculateTwitterUsers(ticketMasterEvent, twitter_dict)

@app.route('/home')
def index():

  appDict = {
   'name': 'messenger',
   'playstore': True,
   'company': 'Facebook',
   'price': 100
  }
  app_json = json.dumps(appDict)
  return jsonify(app_json)
if __name__ == "__main__":
   app.run(debug=True)